<!-- src/views/register.hbs -->
<h2>Registrarse</h2>
<form id="registerForm" action="/api/sessions/register" method="POST">
    <div>
        <label for="first_name">Nombre:</label>
        <input type="text" id="first_name" name="first_name" required>
    </div>
    <div>
        <label for="last_name">Apellido:</label>
        <input type="text" id="last_name" name="last_name" required>
    </div>
    <div>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
    </div>
    <div>
        <label for="age">Edad:</label>
        <input type="number" id="age" name="age" required>
    </div>
    <div>
        <label for="password">Contraseña:</label>
        <input type="password" id="password" name="password" required>
    </div>
    <button type="submit">Registrarse</button>
    </form>
    <p>¿Ya tienes cuenta? <a href="/login">Inicia sesión aquí</a></p>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('registerForm');

        form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        try {
            const response = await fetch('/api/sessions/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
            credentials: 'include',
            });

            const result = await response.json();

            if (response.ok && result.status === 'success') {
            Swal.fire({
                icon: 'success',
                title: '¡Éxito!',
                text: 'Registro exitoso. Serás redirigido al login.',
                timer: 1500,
                showConfirmButton: false,
            }).then(() => {
                window.location.href = '/login';
            });
            } else {
            Swal.fire({
                icon: 'error',
                title: 'Error de Registro',
                text: result.message || 'No se pudo completar el registro.',
            });
            }
        } catch (error) {
            console.error('Error de red al registrarse:', error);
            Swal.fire({
            icon: 'error',
            title: 'Error de Conexión',
            text: 'No se pudo conectar al servidor para registrarse.',
            });
        }
        });
    });
</script>